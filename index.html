<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SelahX</title>
    <style>
        /* --- Âü∫Á°Ä --- */
        body { margin: 0; background-color: #000; font-family: 'Arial', sans-serif; overflow-x: hidden; cursor: pointer; }

        /* ËÆ© 3D canvas Âú®ÊúÄ‰∏äÂ±ÇÔºå‰ΩÜ‰∏çÈòªÂ°ûÈº†Ê†á‰∫ã‰ª∂ */
        #canvas-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1; pointer-events: none; }

        #loader { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; font-size: 12px; letter-spacing: 4px; pointer-events: none; z-index: 220; transition: opacity 0.5s; }

        /* ÂÜÖÂÆπÂ±Ç */
        .content-layer { position: relative; z-index: 10; width: 100%; margin-top: 100vh; padding-bottom: 100px; background: linear-gradient(to bottom, rgba(0,0,0,0.0) 0%, rgba(5,5,5,0.72) 18%, #050505 100%); }

        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; padding: 20px; }
        @media (min-width: 768px) { .gallery-grid { gap: 32px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); } }

        .photo-card { background: rgba(17,17,17,0.9); border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; overflow: hidden; transition: transform 0.28s, box-shadow 0.28s; }
        .photo-card:hover { transform: translateY(-6px); box-shadow: 0 12px 30px rgba(0,0,0,0.6); border-color: rgba(255,255,255,0.14); }
        .photo-inner { width: 100%; aspect-ratio: 3/4; overflow: hidden; }
        .photo-inner img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%); transition: transform 0.45s, filter 0.45s; display: block; }
        .photo-card.in-view img, .photo-card:hover img { filter: grayscale(0%); transform: scale(1.04); }
        .photo-meta { padding: 10px; color: #9b9b9b; font-size: 11px; letter-spacing: 1px; text-transform: uppercase; background: rgba(0,0,0,0.6); }

        /* Lightbox */
        .lightbox { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 260; background: rgba(0,0,0,0.0); backdrop-filter: blur(0px); transition: backdrop-filter 0.45s ease, background 0.45s ease; pointer-events: auto; }
        .lightbox.open { display: flex; background: rgba(0,0,0,0.65); backdrop-filter: blur(12px); }

        .lightbox-img {
            max-width: 95vw; max-height: 90vh; transform-origin: center; transform: scale(0.28) translateY(44px); opacity: 0;
            filter: drop-shadow(0 0 0px rgba(0,150,255,0.0));
            transition: transform 0.58s cubic-bezier(.16,.84,.36,1), opacity 0.45s ease-out, filter 0.6s ease-out;
            border-radius: 12px; will-change: transform, opacity;
        }
        .lightbox.open .lightbox-img { transform: scale(1) translateY(0px); opacity: 1; filter: drop-shadow(0 18px 40px rgba(0,150,255,0.22)); }

        .lightbox-close { position: fixed; top: 24px; right: 24px; color: #fff; font-size: 18px; z-index: 270; cursor: pointer; opacity: 0; transform: translateY(-10px); transition: 0.35s ease-out; }
        .lightbox.open .lightbox-close { opacity: 1; transform: translateY(0); }

        /* Â∞èÊí≠ÊîæÂô® */
        .mini-player { position: fixed; bottom: 30px; right: 30px; width: 44px; height: 44px; border-radius: 50%; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); backdrop-filter: blur(5px); z-index: 240; display: flex; align-items: center; justify-content: center; pointer-events: auto; }
        .play-icon { width: 0; height: 0; border: 6px solid transparent; border-left: 10px solid #fff; margin-left: 2px; }
        .playing .mini-player { border-color: #ffd700; animation: spin 4s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .footer { text-align: center; color: #9b9b9b; padding: 50px; font-size: 11px; letter-spacing: 2px; }
        @media (max-height: 680px) { .content-layer { margin-top: 110vh; } }
    </style>
</head>
<body>

    <audio id="bg-music" loop crossorigin="anonymous">
        <source src="xxx.mp3" type="audio/mpeg">
    </audio>

    <div id="loader">üí´</div>
    <div id="canvas-container"></div>

    <div class="mini-player" onclick="toggleMusic(event)"><div class="play-icon"></div></div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox" onclick="(event)=>{ if(event.target.id==='lightbox' || event.target.classList.contains('lightbox')) window.closeLightbox(event);} " aria-hidden="true">
        <div class="lightbox-close" role="button" aria-label="close" onclick="window.closeLightbox(event)">‚úï</div>
        <img id="lightboxImg" class="lightbox-img" src="" alt="expanded">
    </div>

    <div class="content-layer">
        <div class="gallery-grid">
            <div class="photo-card"><div class="photo-inner"><img src="https://images.unsplash.com/photo-1492691527719-9d1e07e534b4?w=1200" loading="lazy" alt="work01"></div><div class="photo-meta">Work 01</div></div>
            <div class="photo-card"><div class="photo-inner"><img src="https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=1200" loading="lazy" alt="work02"></div><div class="photo-meta">Work 02</div></div>
            <div class="photo-card"><div class="photo-inner"><img src="https://images.unsplash.com/photo-1504198266287-1659872e6590?w=1200" loading="lazy" alt="work03"></div><div class="photo-meta">Work 03</div></div>
            <div class="photo-card"><div class="photo-inner"><img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=1200" loading="lazy" alt="work04"></div><div class="photo-meta">Work 04</div></div>
            <div class="photo-card"><div class="photo-inner"><img src="https://images.unsplash.com/photo-1500462918059-b1a0cb512f1d?w=1200" loading="lazy" alt="work05"></div><div class="photo-meta">Work 05</div></div>
            <div class="photo-card"><div class="photo-inner"><img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=1200" loading="lazy" alt="work06"></div><div class="photo-meta">Work 06</div></div>
        </div>
        <div class="footer">&copy; 2025 SELAHX</div>
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

        // make closeLightbox available globally
        window.closeLightbox = function(e){
            if(e && e.target && e.target.id === 'lightboxImg') return;
            const lb = document.getElementById('lightbox'); if(!lb) return;
            lb.classList.remove('open');
            const img = document.getElementById('lightboxImg'); if(img) img.src = '';
            document.body.style.overflow = '';
        };

        function $(sel){ return document.querySelector(sel); }

        let scene, camera, renderer;
        let particles, river;
        let particleData = [];
        let dummy = new THREE.Object3D();
        let time = 0; let scrollY = 0; let isPressed = false;

        const COL_SILVER = new THREE.Color(0xffffff);
        const COL_GOLD = new THREE.Color(0xffaa00);

        // Â≠òÂÇ® Logo ÁöÑÂéüÂßã 3D Â∞∫ÂØ∏
        let logoBox = { minY: Infinity, maxY: -Infinity, minX: Infinity, maxX: -Infinity, centerY: 0, width: 0, height: 0 };
        // Âä®ÊÄÅËÆ°ÁÆóÁöÑ Logo Âü∫Á°Ä‰ΩçÁΩÆ
        let particleBaseY = 0;

        setTimeout(() => { const l = $('#loader'); if(l) l.style.opacity = '0'; }, 1000);

        init(); animate(); initScrollObserver(); initGalleryInteractions();

        function init(){
            const container = document.getElementById('canvas-container');
            scene = new THREE.Scene(); scene.background = new THREE.Color(0x050505); scene.fog = new THREE.FogExp2(0x050505, 0.015);

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;
            renderer.outputEncoding = THREE.sRGBEncoding;
            container.appendChild(renderer.domElement);

            const ambient = new THREE.AmbientLight(0xffffff, 0.8); scene.add(ambient);
            const dirLight = new THREE.DirectionalLight(0xffffff, 2.0); dirLight.position.set(0, 10, 10); scene.add(dirLight);
            const bottomLight = new THREE.PointLight(0x66aaff, 1.2); bottomLight.position.set(0, -10, 5); scene.add(bottomLight);

            createLogoParticles('SELAHX');
            createMercuryRiver();

            // ÂàùÂßãÂåñÂêéÁ´ãÂç≥Ë∞ÉÁî®‰∏ÄÊ¨°Â∏ÉÂ±ÄÊõ¥Êñ∞
            updateCameraLayout();

            window.addEventListener('resize', onResize);
            window.addEventListener('scroll', () => { scrollY = window.scrollY || window.pageYOffset; });

            window.addEventListener('mousedown', () => isPressed = true);
            window.addEventListener('mouseup', () => isPressed = false);
            window.addEventListener('touchstart', () => isPressed = true, {passive: true});
            window.addEventListener('touchend', () => isPressed = false);
        }

        function createLogoParticles(text){
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const w = 1024, h = 256; canvas.width = w; canvas.height = h;
            ctx.fillStyle = '#000'; ctx.fillRect(0,0,w,h);
            ctx.fillStyle = '#fff'; ctx.font = '900 140px Arial, sans-serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.fillText(text, w/2, h/2);

            const imgData = ctx.getImageData(0,0,w,h); const data = imgData.data; const points = []; const step = 3;

            // ÈááÊ†∑ÂÉèÁ¥†ÁîüÊàêÁÇπ
            for(let y=0;y<h;y+=step){
                for(let x=0;x<w;x+=step){
                    if(data[(y*w+x)*4] > 128){
                        const px = (x - w/2) * 0.05; 
                        const py = -(y - h/2) * 0.05; 
                        const pz = 0;
                        points.push({x:px,y:py,z:pz});
                        
                        // ËÆ∞ÂΩïËæπÁïå
                        logoBox.minY = Math.min(logoBox.minY, py); logoBox.maxY = Math.max(logoBox.maxY, py);
                        logoBox.minX = Math.min(logoBox.minX, px); logoBox.maxX = Math.max(logoBox.maxX, px);
                    }
                }
            }
            
            // ËÆ°ÁÆó Logo Âá†‰Ωï‰∏≠ÂøÉÂíåÂ∞∫ÂØ∏
            logoBox.centerY = (logoBox.minY + logoBox.maxY) / 2;
            logoBox.width = logoBox.maxX - logoBox.minX;
            logoBox.height = logoBox.maxY - logoBox.minY;

            const geo = new THREE.SphereGeometry(0.08, 6, 6);
            const mat = new THREE.MeshStandardMaterial({ color: 0xffffff, metalness: 1.0, roughness: 0.08, emissive: 0x111111 });
            particles = new THREE.InstancedMesh(geo, mat, points.length);

            for(let i=0;i<points.length;i++){
                const pt = points[i]; dummy.position.set(pt.x, pt.y, pt.z); dummy.updateMatrix(); particles.setMatrixAt(i, dummy.matrix);
                particleData.push({ original: new THREE.Vector3(pt.x,pt.y,pt.z), ufo: new THREE.Vector3(), current: new THREE.Vector3(pt.x,pt.y,pt.z), velocity: new THREE.Vector3(), explodeDir: new THREE.Vector3(pt.x,pt.y,pt.z).normalize(), random: Math.random() });
            }

            scene.add(particles);
            // Á≤íÂ≠êÂàõÂª∫ÂÆåÊØïÂêéÔºåÈúÄË¶ÅÂÜçÊ¨°Â∏ÉÂ±Ä‰ª•Á°Æ‰øùÁº©ÊîæÊ≠£Á°Æ
            updateCameraLayout(); 
        }

        function createMercuryRiver(){
            const geo = new THREE.PlaneGeometry(200, 200, 128, 64);
            const mat = new THREE.MeshStandardMaterial({ color: 0xe6eef6, metalness: 1.0, roughness: 0.03, emissive: 0x222233, side: THREE.DoubleSide });
            river = new THREE.Mesh(geo, mat); river.rotation.x = -Math.PI/2; river.position.y = -8; scene.add(river);
        }

        /**
         * Ê†∏ÂøÉ‰øÆÊ≠£ÔºöÂü∫‰∫éËßÜÈî•‰ΩìËÆ°ÁÆóÁº©Êîæ
         * Êó†ËÆ∫ËÆæÂ§áÂÆΩÈ´òÊØîÂ¶Ç‰ΩïÔºåÈÉΩËÆ© Logo ÂÆΩÂ∫¶ÈÄÇÂ∫îÂ±èÂπïÂÆΩÂ∫¶
         */
        function updateCameraLayout(){
            if(!camera || !renderer) return;

            // 1. ËÆæÁΩÆ‰∏Ä‰∏™Âõ∫ÂÆöÁöÑÊ†áÂáÜÊëÑÂÉèÊú∫Ë∑ùÁ¶ªÔºå‰øùËØÅËÉåÊôØÂíåÂÖâÁÖßÁöÑ‰∏ÄËá¥ÊÄß
            const dist = 32;
            camera.position.set(0, 2, dist);
            camera.lookAt(0, 0, 0);

            // Êõ¥Êñ∞ÊëÑÂÉèÊú∫Áü©Èòµ
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            // Â¶ÇÊûúÁ≤íÂ≠êËøòÊ≤°ÁîüÊàêÔºåÊó†Ê≥ïËÆ°ÁÆó
            if(!particles || logoBox.width === 0) return;

            // 2. ËÆ°ÁÆóÂú® Z=0 Â§ÑÔºàLogo ÊâÄÂú®Âπ≥Èù¢ÔºâÊëÑÂÉèÊú∫ÁöÑÂèØËßÜÂÆΩÂ∫¶
            // Visible Height = 2 * tan(fov / 2) * distance
            const vFOV = THREE.MathUtils.degToRad(camera.fov);
            const visibleHeight = 2 * Math.tan(vFOV / 2) * dist;
            const visibleWidth = visibleHeight * camera.aspect;

            // 3. ËÆ°ÁÆóÁõÆÊ†áÁº©ÊîæÊØî‰æã
            // Êàë‰ª¨Â∏åÊúõ Logo Âç†ÊçÆÂ±èÂπïÂÆΩÂ∫¶ÁöÑ 85% (0.85)ÔºåÊàñËÄÖÂ±èÂπïÈ´òÂ∫¶ÁöÑ 50%ÔºàÈò≤Ê≠¢Âú®Ë∂ÖÂÆΩÂ±è‰∏äËøáÂ§ßÔºâ
            let scaleFitWidth = (visibleWidth * 0.85) / logoBox.width;
            let scaleFitHeight = (visibleHeight * 0.5) / logoBox.height;

            // Âèñ‰∏§ËÄÖËæÉÂ∞èÂÄºÔºåÁ°Æ‰øù Logo Êó¢‰∏ç‰ºöË∂ÖÂá∫ÂÆΩÂ∫¶Ôºå‰πü‰∏ç‰ºöË∂ÖÂá∫È´òÂ∫¶
            let finalScale = Math.min(scaleFitWidth, scaleFitHeight);

            // ÈôêÂà∂ÊúÄÂ§ßÁº©ÊîæÔºåÈò≤Ê≠¢Âú®Â§ßÂ±èÂπï‰∏äÂèòÂæóËçíË∞¨Â∑®Â§ß
            finalScale = Math.min(finalScale, 1.8); 

            // Â∫îÁî®Áº©Êîæ
            particles.scale.setScalar(finalScale);

            // 4. ÈáçÊñ∞Ë∞ÉÊï¥ÂûÇÁõ¥‰ΩçÁΩÆ
            // ËÆ© Logo ÁöÑËßÜËßâ‰∏≠ÂøÉÁ®çÂæÆÂêë‰∏äÂÅèÁßª‰∏ÄÁÇπÔºåÁúãËµ∑Êù•Êõ¥Âπ≥Ë°°
            // Êàë‰ª¨ÂáèÂéª centerY * scale ÊòØ‰∏∫‰∫ÜÊäµÊ∂à Logo Ëá™Ë∫´ÁöÑÂéüÁÇπÂÅèÁßª
            particleBaseY = 4.0 - (logoBox.centerY * finalScale);
            particles.position.y = particleBaseY;
        }

        function animate(){
            requestAnimationFrame(animate);
            time += 0.02;
            const scrollFactor = Math.min(Math.max(scrollY / 500, 0), 1);

            // Logo ÈöèÊªöÂä®‰∏ãÊªë
            if(particles){
                // ‰ΩøÁî®ËÆ°ÁÆóÂá∫ÁöÑ particleBaseY ‰Ωú‰∏∫Âü∫ÂáÜ
                particles.position.y = particleBaseY - scrollY * 0.015;
            }

            if(particles){
                const targetColor = isPressed ? COL_GOLD : COL_SILVER;
                particles.material.color.lerp(targetColor, 0.08);
                particles.material.emissive.lerp(new THREE.Color(isPressed ? 0x442200 : 0x222222), 0.08);

                const ufoRot = time * 3.6;
                for(let i=0;i<particleData.length;i++){
                    const d = particleData[i];
                    const angle = d.random * Math.PI * 2 + ufoRot; const radius = 2.0 + d.random * 1.0;
                    d.ufo.set(Math.cos(angle) * radius, Math.sin(angle * radius * 0.5) * 0.5, Math.sin(angle) * radius);
                    
                    const targetX = d.original.x * (1 - scrollFactor) + d.ufo.x * scrollFactor;
                    const targetY = d.original.y * (1 - scrollFactor) + d.ufo.y * scrollFactor;
                    const targetZ = d.original.z * (1 - scrollFactor) + d.ufo.z * scrollFactor;

                    if(isPressed){
                        d.velocity.x += (Math.random()-0.5)*0.02; d.velocity.y += (Math.random()-0.5)*0.02; d.velocity.z += (Math.random()-0.5)*0.02;
                    } else {
                        const tx = targetX - d.current.x; const ty = targetY - d.current.y; const tz = targetZ - d.current.z;
                        d.velocity.x += tx * 0.12; d.velocity.y += ty * 0.12; d.velocity.z += tz * 0.12;
                        d.velocity.multiplyScalar(0.68);
                    }

                    const maxSpeed = 2.5; if(d.velocity.length() > maxSpeed) d.velocity.setLength(maxSpeed);
                    d.current.add(d.velocity);

                    const distFromCenter = d.current.length(); const maxAllowed = 32;
                    if(distFromCenter > maxAllowed){ d.current.lerp(d.original, 0.06); d.velocity.multiplyScalar(0.35); }

                    dummy.position.copy(d.current);
                    
                    // Á≤íÂ≠êÂ§ßÂ∞è‰πüÈúÄË¶ÅÈöèÊï¥‰ΩìÁº©ÊîæË∞ÉÊï¥ÔºåÂê¶Âàô Logo ÂèòÂ∞èÊó∂Á≤íÂ≠ê‰ºöÊòæÂæóÂ§™Êå§
                    const s = (1 - scrollFactor * 0.45) * (isPressed ? 1.4 : 1.0);
                    // ËøôÈáåÁöÑ scale.x Â∑≤ÁªèÊòØÊàë‰ª¨ËÆ°ÁÆóÂá∫ÁöÑ finalScale
                    dummy.scale.setScalar(s * particles.scale.x); 
                    
                    dummy.updateMatrix(); particles.setMatrixAt(i, dummy.matrix);
                }

                if(scrollFactor > 0.5) particles.rotation.y += 0.04 * scrollFactor; else particles.rotation.y = 0;
                particles.instanceMatrix.needsUpdate = true;
            }

            if(river){ const pos = river.geometry.attributes.position; for(let i=0;i<pos.count;i++){ const x = pos.getX(i); const y = pos.getY(i); const z = Math.sin(x * 0.12 + time) * 1.6 + Math.cos(y * 0.09 + time) * 0.8; pos.setZ(i, z); } pos.needsUpdate = true; river.geometry.computeVertexNormals(); }

            renderer.render(scene, camera);
        }

        function initScrollObserver(){ const observer = new IntersectionObserver((entries)=>{ entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('in-view'); }); }, { threshold: 0.12 }); document.querySelectorAll('.photo-card').forEach(el=>observer.observe(el)); }

        function initGalleryInteractions(){ document.querySelectorAll('.photo-inner img').forEach(img=>{ img.addEventListener('click', (e)=>{ openLightbox(e.currentTarget.src, e.currentTarget); }); img.addEventListener('touchend', (e)=>{ openLightbox(e.currentTarget.src, e.currentTarget); }); }); }

        function openLightbox(src, thumb){
            const lb = document.getElementById('lightbox'); const li = document.getElementById('lightboxImg'); if(!li || !lb) return;
            li.src = src; li.style.transition = 'none'; li.style.transform = 'scale(0.28) translateY(44px)'; li.style.opacity = '0'; li.style.filter = 'drop-shadow(0 0 0 rgba(0,150,255,0))';
            requestAnimationFrame(()=>{ lb.classList.add('open'); requestAnimationFrame(()=>{ li.style.transition = ''; li.style.transform = ''; li.style.opacity = ''; li.style.filter = ''; }); });
            document.body.style.overflow = 'hidden';
        }

        function onResize(){ if(renderer && camera){ renderer.setSize(window.innerWidth, window.innerHeight); updateCameraLayout(); } }

        window.toggleMusic = function(e){ e.stopPropagation(); const audio = document.getElementById('bg-music'); const btn = document.querySelector('.mini-player'); if(audio.paused){ audio.play(); btn.classList.add('playing'); } else { audio.pause(); btn.classList.remove('playing'); } };
    </script>
</body>
</html>