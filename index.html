<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SelahX</title>
    <style>
        /* --- 基础设置 --- */
        body { margin: 0; background-color: #020202; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; overflow-x: hidden; }

        /* 3D Canvas */
        #canvas-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1; pointer-events: none; }

        /* Loading */
        #loader { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            color: rgba(255,255,255,0.6); font-size: 11px; letter-spacing: 3px; font-weight: 300; 
            z-index: 220; transition: opacity 0.5s ease; pointer-events: none;
            width: 100%; text-align: center;
        }

        /* --- 内容层 --- */
        .content-layer { 
            position: relative; 
            z-index: 10; 
            width: 100%; 
            margin-top: 100vh; 
            padding-bottom: 120px; 
            background: transparent;
        }

        .gallery-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 25px; 
            max-width: 1100px; 
            margin: 0 auto; 
            padding: 40px 20px; 
        }

        @media (max-width: 768px) {
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr); 
                gap: 10px; 
                padding: 20px 10px;
            }
            .content-layer { margin-top: 90vh; }
        }

        /* --- 卡片 --- */
        .photo-card { 
            position: relative;
            border-radius: 10px; 
            overflow: hidden; 
            transition: transform 0.3s ease-out;
            background: rgba(18, 18, 18, 0.6);
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        .photo-card:hover { 
            transform: translateY(-5px); 
            background: rgba(40, 40, 40, 0.7);
            border-color: rgba(255,255,255,0.3);
        }

        .photo-inner { position: relative; width: 100%; aspect-ratio: 4/5; overflow: hidden; }
        .photo-inner img { 
            width: 100%; height: 100%; object-fit: cover; display: block; 
            pointer-events: none; user-select: none; transition: transform 0.6s ease;
        }
        .photo-card:hover .photo-inner img { transform: scale(1.04); }

        .view-btn {
            position: absolute; bottom: 10px; right: 10px; width: 30px; height: 30px;
            border-radius: 50%; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.3); display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 20; transition: all 0.2s;
        }
        .view-btn svg { width: 14px; height: 14px; fill: #fff; }

        .photo-meta { 
            padding: 10px 12px; color: rgba(255,255,255,0.85); font-size: 11px; font-weight: 600;
            letter-spacing: 1px; text-transform: uppercase; display: flex; justify-content: space-between; align-items: center;
        }
        .meta-sub { font-size: 9px; color: rgba(255,255,255,0.4); }

        /* --- 播放器 --- */
        .mini-player { 
            position: fixed; bottom: 25px; right: 25px; width: 42px; height: 42px; 
            border-radius: 50%; background: rgba(25, 25, 25, 0.7); border: 1px solid rgba(255,255,255,0.2); 
            backdrop-filter: blur(10px); z-index: 240; display: flex; align-items: center; justify-content: center; 
            cursor: pointer; transition: all 0.3s;
        }
        .mini-player.playing { border-color: #fff; box-shadow: 0 0 15px rgba(255, 255, 255, 0.3); }
        .player-svg { width: 16px; height: 16px; fill: #fff; display: block; pointer-events: none; }
        .icon-pause { display: none; } .icon-play { display: block; margin-left: 2px; }
        .mini-player.playing .icon-play { display: none; } .mini-player.playing .icon-pause { display: block; margin-left: 0; }

        /* --- Lightbox --- */
        .lightbox { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 260; background: rgba(0,0,0,0); transition: all 0.4s; }
        .lightbox.open { display: flex; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); }
        .lightbox-img { max-width: 95vw; max-height: 90vh; transform: scale(0.95); opacity: 0; transition: all 0.4s; border-radius: 4px; box-shadow: 0 0 40px rgba(0,0,0,0.8); }
        .lightbox.open .lightbox-img { transform: scale(1); opacity: 1; }
        .lightbox-close { position: fixed; top: 25px; right: 25px; color: #fff; width: 40px; height: 40px; background: rgba(255,255,255,0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; transform: translateY(-10px); transition: 0.3s; }
        .lightbox.open .lightbox-close { opacity: 1; transform: translateY(0); }

        .footer { text-align: center; color: rgba(255,255,255,0.3); padding: 60px; font-size: 10px; letter-spacing: 2px; }
    </style>
</head>
<body>

    <audio id="bg-music" loop crossorigin="anonymous">
        <source src="bgm.mp3" type="audio/mpeg">
    </audio>

    <div id="loader">VISION</div>
    <div id="canvas-container"></div>

    <div class="mini-player" onclick="toggleMusic(event)">
        <svg class="player-svg icon-play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        <svg class="player-svg icon-pause" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
    </div>

    <div class="lightbox" id="lightbox" onclick="(event)=>{ if(event.target.id==='lightbox' || event.target.classList.contains('lightbox')) window.closeLightbox(event);} ">
        <div class="lightbox-close" onclick="window.closeLightbox(event)">✕</div>
        <img id="lightboxImg" class="lightbox-img" src="" alt="expanded">
    </div>

    <div class="content-layer">
        <div class="gallery-grid">
            <div class="photo-card">
                <div class="photo-inner"><img src="111.jpg" loading="lazy" alt="work"><button class="view-btn"><svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg></button></div>
                <div class="photo-meta"><span>Alpha</span><span class="meta-sub">01</span></div>
            </div>
            <div class="photo-card">
                <div class="photo-inner"><img src="IMG_8317.jpeg" loading="lazy" alt="work"><button class="view-btn"><svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg></button></div>
                <div class="photo-meta"><span>Beta</span><span class="meta-sub">02</span></div>
            </div>
            <div class="photo-card">
                <div class="photo-inner"><img src="IMG_8318.jpeg" loading="lazy" alt="work"><button class="view-btn"><svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg></button></div>
                <div class="photo-meta"><span>Gamma</span><span class="meta-sub">03</span></div>
            </div>
            <div class="photo-card">
                <div class="photo-inner"><img src="IMG_8322.jpeg" loading="lazy" alt="work"><button class="view-btn"><svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg></button></div>
                <div class="photo-meta"><span>Delta</span><span class="meta-sub">04</span></div>
            </div>
             <div class="photo-card">
                <div class="photo-inner"><img src="IMG_8329.jpeg" loading="lazy" alt="work"><button class="view-btn"><svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg></button></div>
                <div class="photo-meta"><span>Echo</span><span class="meta-sub">05</span></div>
            </div>
             <div class="photo-card">
                <div class="photo-inner"><img src="IMG_8340.jpeg" loading="lazy" alt="work"><button class="view-btn"><svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg></button></div>
                <div class="photo-meta"><span>Zeta</span><span class="meta-sub">06</span></div>
            </div>
        </div>
        <div class="footer">&copy; 2026 SELAHX</div>
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

        // --- UI Logic ---
        window.toggleMusic = (e) => {
            e.stopPropagation();
            const audio = document.getElementById('bg-music');
            const btn = document.querySelector('.mini-player');
            if(audio.paused){ audio.play(); btn.classList.add('playing'); } 
            else { audio.pause(); btn.classList.remove('playing'); }
        };
        window.closeLightbox = (e) => {
            if(e && e.target && e.target.id === 'lightboxImg') return;
            document.getElementById('lightbox').classList.remove('open');
            setTimeout(() => { document.getElementById('lightboxImg').src = ''; }, 500);
        };
        function openLightbox(src){
            const li = document.getElementById('lightboxImg'); li.src = src;
            document.getElementById('lightbox').classList.add('open');
        }

        // --- 3D Core ---
        let scene, camera, renderer;
        let particles, geometry;
        let river, riverGeometry;
        let lights = [];
        let time = 0; 
        let scrollY = 0; 
        
        let currentPositions, targetPositions; // 物理位置缓存

        init(); 
        animate(); 
        initEvents();

        function init(){
            setTimeout(() => { document.getElementById('loader').style.opacity = '0'; }, 500);

            const container = document.getElementById('canvas-container');
            scene = new THREE.Scene(); 
            scene.background = new THREE.Color(0x020202); 
            scene.fog = new THREE.FogExp2(0x020202, 0.015);

            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ antialias: false, alpha: false, powerPreference: "high-performance" });
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            // 优化关键 1：限制像素比，防止高分屏掉帧
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
            
            renderer.outputEncoding = THREE.sRGBEncoding;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            container.appendChild(renderer.domElement);

            // 光源
            for(let i=0; i<3; i++){
                const light = new THREE.PointLight(0xffffff, 4.0, 90); 
                lights.push(light);
                scene.add(light);
            }
            const ambient = new THREE.AmbientLight(0x111111); 
            scene.add(ambient);

            createMorphParticles();
            createRiver(); 
            updateCamera();

            window.addEventListener('resize', onResize);
            window.addEventListener('scroll', () => { scrollY = window.scrollY || window.pageYOffset; });
        }

        function createMorphParticles(){
            const canvas = document.createElement('canvas');
            const w = 1024, h = 512;
            canvas.width = w; canvas.height = h;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#000'; ctx.fillRect(0,0,w,h);
            
            ctx.font = '900 110px "Arial", sans-serif'; 
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.fillStyle = '#fff';
            ctx.fillText('SELAHX', w/2, h/2);

            const imgData = ctx.getImageData(0,0,w,h).data;
            const logoPoints = [];
            
            const isMobile = window.innerWidth < 768;
            const spread = isMobile ? 0.018 : 0.025; 
            const step = 4;

            for(let y=0; y<h; y+=step){
                for(let x=0; x<w; x+=step){
                    if(imgData[(y*w+x)*4] > 128){
                        const px = (x - w/2) * spread; 
                        const py = -(y - h/2) * spread + 2.0; 
                        const pz = (Math.random() - 0.5) * 0.6; 
                        logoPoints.push(new THREE.Vector3(px, py, pz));
                    }
                }
            }

            const eaglePoints = [];
            const count = logoPoints.length;
            
            for(let i=0; i<count; i++){
                const t = (i / count) * 2 - 1; 
                const wingSpan = isMobile ? 9 : 16; 
                
                const x = t * wingSpan;
                let y = Math.cos(t * Math.PI) * 1.5; 
                y += Math.pow(Math.abs(t), 3) * 2.0;
                let z = Math.abs(t) * 3.0; 
                z += (Math.random()-0.5) * 0.8;
                eaglePoints.push(new THREE.Vector3(
                    x + (Math.random()-0.5)*0.3, 
                    y + (Math.random()-0.5)*0.3 + 5, 
                    z 
                ));
            }

            const randomPoints = [];
            for(let i=0; i<count; i++){
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos((Math.random() * 2) - 1);
                const r = 40 + Math.random() * 30; 
                const x = r * Math.sin(phi) * Math.cos(theta);
                const y = r * Math.sin(phi) * Math.sin(theta);
                const z = r * Math.cos(phi);
                randomPoints.push(new THREE.Vector3(x, y, z));
            }

            geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 3);
            const posLogo = new Float32Array(count * 3);
            const posEagle = new Float32Array(count * 3);
            const colors = new Float32Array(count * 3);

            currentPositions = new Float32Array(count * 3);

            for(let i=0; i<count; i++){
                currentPositions[i*3] = randomPoints[i].x;
                currentPositions[i*3+1] = randomPoints[i].y;
                currentPositions[i*3+2] = randomPoints[i].z;

                positions[i*3] = currentPositions[i*3];
                positions[i*3+1] = currentPositions[i*3+1];
                positions[i*3+2] = currentPositions[i*3+2];

                posLogo[i*3] = logoPoints[i].x;
                posLogo[i*3+1] = logoPoints[i].y;
                posLogo[i*3+2] = logoPoints[i].z;

                posEagle[i*3] = eaglePoints[i].x;
                posEagle[i*3+1] = eaglePoints[i].y;
                posEagle[i*3+2] = eaglePoints[i].z;
                
                colors[i*3] = 0.2; colors[i*3+1] = 0.2; colors[i*3+2] = 0.2;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('posLogo', new THREE.BufferAttribute(posLogo, 3));
            geometry.setAttribute('posEagle', new THREE.BufferAttribute(posEagle, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({
                size: isMobile ? 0.09 : 0.08, 
                vertexColors: true, 
                transparent: true,
                opacity: 0.95,
                blending: THREE.AdditiveBlending,
                sizeAttenuation: true,
                // 优化关键 2：关闭深度写入，消除粒子重叠时的闪烁 (Anti-Flicker)
                depthWrite: false 
            });

            particles = new THREE.Points(geometry, material);
            scene.add(particles);
        }

        function createRiver(){
            riverGeometry = new THREE.PlaneGeometry(300, 300, 128, 128); 
            const mat = new THREE.MeshStandardMaterial({ 
                color: 0x050505, 
                metalness: 0.95, 
                roughness: 0.15, 
                side: THREE.DoubleSide
            });
            river = new THREE.Mesh(riverGeometry, mat);
            river.rotation.x = -Math.PI / 2; 
            river.position.y = -4.0; 
            scene.add(river);
        }

        function updateCamera(){
            const isMobile = window.innerWidth < 768;
            const dist = isMobile ? 35 : 22; 
            camera.position.set(0, 0, dist);
            camera.lookAt(0, 0, 0);
        }

        function animate(){
            requestAnimationFrame(animate);
            time += 0.01;

            const hueBase = time * 0.02; 
            lights.forEach((light, i) => {
                const angle = time * 0.4 + (i * Math.PI * 2 / 3);
                const radius = 18;
                light.position.x = Math.cos(angle) * radius;
                light.position.z = Math.sin(angle) * radius;
                light.position.y = 6 + Math.sin(time + i) * 3;
                const h = (hueBase + i * 0.1) % 1.0;
                light.color.setHSL(h, 0.9, 0.6); 
            });

            const scrollFactor = Math.min(Math.max(scrollY / 500, 0), 1);
            const isIntro = time < 3.0;

            if(particles && geometry){
                const pos = geometry.attributes.position.array;
                const pLogo = geometry.attributes.posLogo.array;
                const pEagle = geometry.attributes.posEagle.array;
                const cols = geometry.attributes.color.array;
                const count = pos.length / 3;
                
                const flapSpeed = time * 2.5; 
                // 优化关键 3：减少 GC，复用对象
                const pVec = new THREE.Vector3();
                const colTemp = new THREE.Color();
                const baseColor = new THREE.Color(0x1a1a1a); 
                const damping = 0.05;

                for(let i=0; i<count; i++){
                    const ix = i * 3; const iy = i * 3 + 1; const iz = i * 3 + 2;

                    let targetX = pLogo[ix] * (1 - scrollFactor) + pEagle[ix] * scrollFactor;
                    let targetY = pLogo[iy] * (1 - scrollFactor) + pEagle[iy] * scrollFactor;
                    let targetZ = pLogo[iz] * (1 - scrollFactor) + pEagle[iz] * scrollFactor;

                    if(scrollFactor > 0.01){
                        const dist = Math.abs(pEagle[ix]);
                        targetY += Math.sin(flapSpeed) * (dist * 0.12) * scrollFactor;
                    } else if(!isIntro) {
                        targetY += Math.sin(time * 2 + pLogo[ix] * 0.5) * 0.05;
                    }

                    // 物理平滑移动
                    currentPositions[ix] += (targetX - currentPositions[ix]) * damping;
                    currentPositions[iy] += (targetY - currentPositions[iy]) * damping;
                    currentPositions[iz] += (targetZ - currentPositions[iz]) * damping;

                    pos[ix] = currentPositions[ix];
                    pos[iy] = currentPositions[iy];
                    pos[iz] = currentPositions[iz];

                    pVec.set(pos[ix], pos[iy], pos[iz]);

                    // 光影计算优化
                    colTemp.copy(baseColor);
                    for(let l=0; l<3; l++){
                        const light = lights[l];
                        // 快速距离计算，不使用 sqrt，稍微牺牲精度换取性能
                        const dx = pVec.x - light.position.x;
                        const dy = pVec.y - light.position.y;
                        const dz = pVec.z - light.position.z;
                        const distSq = dx*dx + dy*dy + dz*dz;
                        
                        const intensity = 150 / (distSq + 10); 
                        
                        colTemp.r += light.color.r * intensity * 0.1;
                        colTemp.g += light.color.g * intensity * 0.1;
                        colTemp.b += light.color.b * intensity * 0.1;
                    }
                    
                    cols[ix] = Math.min(colTemp.r, 1.2);
                    cols[iy] = Math.min(colTemp.g, 1.2);
                    cols[iz] = Math.min(colTemp.b, 1.2);
                }
                geometry.attributes.position.needsUpdate = true;
                geometry.attributes.color.needsUpdate = true;

                if(!isIntro){
                    if(scrollFactor > 0.1){
                        particles.position.z = (scrollFactor - 0.5) * 4; 
                        particles.rotation.x = Math.sin(time * 0.5) * 0.08;
                        particles.rotation.y = 0;
                    } else {
                        particles.position.z = 0;
                        particles.rotation.x = 0;
                        particles.rotation.y = Math.sin(time * 0.6) * 0.25; 
                    }
                }
            }

            if(river && riverGeometry){
                const pos = riverGeometry.attributes.position;
                for(let i=0; i<pos.count; i++){
                    const x = pos.getX(i);
                    const y = pos.getY(i);
                    const w1 = Math.sin(x*0.1 + time*0.8);
                    const w2 = Math.cos(y*0.08 + time*0.6);
                    const w3 = Math.sin((x+y)*0.2 + time);
                    pos.setZ(i, (w1+w2+w3) * 1.0);
                }
                pos.needsUpdate = true;
                riverGeometry.computeVertexNormals();
            }

            renderer.render(scene, camera);
        }

        function initEvents(){
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const img = e.currentTarget.parentElement.querySelector('img');
                    if(img) openLightbox(img.src);
                });
            });
        }

        function onResize(){
            if(renderer && camera){
                renderer.setSize(window.innerWidth, window.innerHeight);
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                updateCamera();
            }
        }
    </script>
</body>
</html>
